<html lang="en">
    <head>
        <title>DV Slide 2</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <!-- Load d3.js -->
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

        <!-- Load stylesheets -->
        <link rel='stylesheet' type='text/css' href='./stylesheets/page-style.css'>

        <style>
            /* Page Content */
            .content {padding:20px;}
        </style>
    </head>
    <body>
        <div class="header">
            <h1>Is India Slowing Its Population Growth?</h1>
            <p class="header-text-footer-1">Data Visualization Aassignment - UIUC - MSDS</p>
            <p class="header-text-footer-2">by Rajlakshman Kulkarni</p>
        </div>

        <div class="navbar">
            <a href="https://rajlakshmank.github.io/dv_slide3.html" class="right">Next &raquo;</a>
            <a href="https://rajlakshmank.github.io/dv_slide1.html" class="right">&laquo; Previous</a>
            <a href="https://rajlakshmank.github.io/dv_slide1.html" class="right">Home</a>
        </div>

        <div class="row">
            <div class="column1">
                <article class="dv_article">
                    <h3>A nation with diversity in every state</h3>
                    <p>
                        India as a nation has 29 states and 7 union territories. Its culture is among the world's oldest. Today, As 
                        diverse country every state has its own distinct culture, language, religion and food habits. 
                    </p>
                    <p>
                        States around the Gengetic plain, the region which has seen aryan migration about 3500 years ago are most 
                        populated. These states are popularly referred as Empowered Action Group (EAG) states and the rest are 
                        called Non-EAG states. There are eight EAG states, namely, Rajasthan, Uttar Pradesh, Uttarakhand, Bihar, 
                        Jharkhand, Madhya Pradesh, Chhattisgarh and Orissa. Chat 3 shows decadal population growth rate for EAG 
                        states, non-EAG states and India. During 1981-2001 growth rate for EAG states remained the same. 
                        From 2001 onwards one can see a positive momentum. Still far behind in closing the gap with Non-EAG states. 
                    </p>
                    <p> 
                        Hence there lies a complex reality, even though India as a country showing promising results in slowing 
                        population growth. EAG states are lagging behind and are the most populated ones. 
                    </p>
                </article> 
            </div>
            <div class="column2">
                    <div id="scene_2_dataviz">
                        <h2 class="graph_header">Decadal Population Growth Rate <br>For EAG States, Non-EAG States And India</h2>
                    </div>
            </div>
        </div>

        <div class="navbar">
            <a href="https://rajlakshmank.github.io/dv_slide3.html" class="right">Next &raquo;</a>
            <a href="https://rajlakshmank.github.io/dv_slide1.html" class="right">&laquo; Previous</a>
            <a href="https://rajlakshmank.github.io/dv_slide1.html" class="right">Home</a>
        </div>

        <div class="footer">
            <h2>Footer</h2>
        </div>
    </body>
    <script>
        // set the dimensions and margins of the graph
        var margin = {top: 60, right: 80, bottom: 80, left: 70},
        width = 550 - margin.left - margin.right,
        height = 450 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        var svg = d3.select("#scene_2_dataviz")
                    .append("svg")
                    .attr("class","svg1")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("class","svg1 group")
                    .attr("transform","translate(" + margin.left + "," + margin.top + ")");

        //Read the data
        var data_url = "https://raw.githubusercontent.com/rajlakshmank/rajlakshmank.github.io/master/data/India-EAG-States-Pop-Growth.csv";
        
        d3.csv(data_url, function(data) {
            
            console.log(data);
            // List of groups (here I have one group per column)
            var allGroup = ["INDIA", "EAG", "Non-EAG"]

            // Reformat the data: we need an array of arrays of {x, y} tuples
            var dataReady = allGroup.map( function(grpName) { // .map allows to do something for each element of the list
            return {
                    name: grpName,
                    values: data.map(function(d) {
                        return {time: d.year, value: +d[grpName]};
                        })
                    };
            });
            console.log(dataReady)

            // A color scale: one color for each group
            var myColor = d3.scaleOrdinal()
                            .domain(allGroup)
                            .range(d3.schemeTableau10);

            // Add X axis --> it is a date format
            var x = d3.scaleLinear()
                    .domain([1960,2020])
                    .range([ 0, width ]);
            svg
                .append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "translate(-10,10)rotate(-45)")
                .attr("class","graph_axis_text")

            //X axis title
            svg
                .append("text")
                .attr("class","graph_axis_title")
                .attr("x", width/2)
                .attr("y", height + margin.bottom -10)
                .text("Year");

            // Add Y axis
            var y = d3.scaleLinear()
                    .domain( [8,27])
                    .range([ height, 0 ]);
            svg
                .append("g")
                .call(d3.axisLeft(y))
                .selectAll("text")
                .attr("class","graph_axis_text")

            //Y axis title
            svg
                .append("text")
                .attr("class","graph_axis_title")
                .attr("transform", "rotate(-90)")
                .attr("y", -margin.left+30)
                .attr("x", -margin.top-60)
                .text("% Population Growth");

            // Add the lines
            var line = d3.line()
                        .x(function(d) { return x(+d.time) })
                        .y(function(d) { return y(+d.value) })

            svg
                .selectAll("myLines")
                .data(dataReady)
                .enter()
                .append("path")
                .attr("class", function(d){ return d.name })
                .attr("d", function(d){ return line(d.values) } )
                .attr("stroke", function(d){ return myColor(d.name) })
                .style("stroke-width", 4)
                .style("fill", "none")

            // Add the points
            svg
                // First we need to enter in a group
                .selectAll("myDots")
                .data(dataReady)
                .enter()
                .append('g')
                .style("fill", function(d){ return myColor(d.name) })
                .attr("class", function(d){ return d.name })
                // Second we need to enter in the 'values' part of this group
                .selectAll("myPoints")
                .data(function(d){ return d.values })
                .enter()
                .append("circle")
                .attr("cx", function(d) { return x(d.time) } )
                .attr("cy", function(d) { return y(d.value) } )
                .attr("r", 5)
                .attr("stroke", "white")
                

            // Add a label at the end of each line
            svg
                .selectAll("myLabels")
                .data(dataReady)
                .enter()
                .append('g')
                .append("text")
                .attr("class", function(d){ return d.name })
                .datum(function(d) { return {name: d.name, value: d.values[d.values.length - 1]}; }) // keep only the last value of each time series
                .attr("transform", function(d) { return "translate(" + x(d.value.time) + "," + y(d.value.value) + ")"; }) // Put the text at the position of the last point
                .attr("x", 12) // shift the text a bit more right
                .text(function(d) { return d.name; })
                .style("fill", function(d){ return myColor(d.name) })
                .style("font-size", 15)


            // Add a legend (interactive)
            svg
                .selectAll("myLegend")
                .data(dataReady)
                .enter()
                .append('g')
                .append("text")
                .attr('x', function(d,i){ return 30 + i*60})
                .attr('y', -20)
                .text(function(d) { return d.name; })
                .style("fill", function(d){ return myColor(d.name) })
                .style("font-size", 15)
                .on("click", function(d){
                // is the element currently visible ?
                currentOpacity = d3.selectAll("." + d.name).style("opacity")
                // Change the opacity: from 0 to 1 or from 1 to 0
                d3.selectAll("." + d.name).transition().style("opacity", currentOpacity == 1 ? 0:1)

        })

        })

    </script>
</html>